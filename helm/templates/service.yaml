{{- $network := .Values.network -}}

{{- $services := dict 
    "node" (list 
      (dict "name" "peers" "port" .Values.ports.node.peers) 
      (dict "name" "rpc" "port" .Values.ports.node.rpc)
    ) 
    "farmer" (list 
      (dict "name" "farmer-peers" "port" .Values.ports.farmer.peers) 
      (dict "name" "farmer-rpc" "port" .Values.ports.farmer.rpc) 
      (dict "name" "wallet-peers" "port" .Values.ports.wallet.peers) 
      (dict "name" "wallet-rpc" "port" .Values.ports.wallet.rpc)
    ) 
    "harvester" (list 
      (dict "name" "peers" "port" .Values.ports.harvester.peers) 
      (dict "name" "rpc" "port" .Values.ports.harvester.rpc)
    )
-}}

{{- range $service, $ports := $services }}
apiVersion: v1
kind: Service
metadata:
  name: {{ $network }}-{{ $service }}
  labels:
    app: {{ $network }}-{{ $service }}
spec:
  ports:
  {{- range $port := $ports }}
  - name: {{ $port.name }}
    protocol: TCP
    port: {{ $port.port }}
  {{- end }}
  selector:
    app: {{ $network }}-{{ $service }}
---
{{- end }}

